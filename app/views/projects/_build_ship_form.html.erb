<h1 class="text-4xl">Submit project</h1>
<p class="text-xl pb-6">Finished building? Review these details and make sure it's correct.</p>

<%= turbo_frame_tag "form_errors" do %>
  <% if @project.errors.any? %>
    <div class="p-4 mb-6 text-red-900 rounded-md bg-bp-danger">
      <p><strong><%= pluralize(@project.errors.count, "error") %></strong> prevented this project from being saved:</p>
      <ul class="pl-5 list-disc">
        <% @project.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>

<%= form_with model: @project, html: { class: "space-y-6", data: { controller: "project-validator", project_validator_project_id_value: @project.id } } do |f| %>
        <%= f.hidden_field :ship, value: true %>

          <div>
            <%= f.label :title, "Title*", class: "block text-xl font-medium font-rc-full" %>
            <%= f.text_field :title,
                  required: true,
                  class: "input px-3 w-full" %>
          </div>

          <div>
            <%= f.label :description, "Description*", class: "block text-xl font-medium font-rc-full" %>
            <%= f.text_area :description,
                  required: true,
                  rows: 6,
                  class: "input px-3 mt-1 block w-full" %>
          </div>

          <div>
            <%= f.label :demo_link, "Demo Link*", class: "block text-xl font-medium font-rc-full" %>
            <p>Record a video of your project working and share it on YouTube or Reddit.</p>
            <%= f.text_field :demo_link,
                  required: true,
                  class: "input px-3 w-full",
                  placeholder: "https://www.youtube.com/..." %>
          </div>

          <div>
            <%= f.label :demo_picture, "Picture of your built project*", class: "block text-xl font-medium font-rc-full" %>
            <p>Take a new picture of your built project! This will replace your current banner.</p>
            <div data-controller="image-preview">
              <div class="my-4">
                <% if @project.demo_picture.attached? %>
                  <% if @project.demo_picture.content_type == "image/svg+xml" %>
                    <%= image_tag @project.demo_picture, class: "rounded border border-bp-muted/40 max-h-64 object-contain", data: { image_preview_target: "preview" } %>
                  <% else %>
                    <%= image_tag @project.demo_picture.variant(:web), class: "rounded border border-bp-muted/40 max-h-64 object-contain", data: { image_preview_target: "preview" } %>
                  <% end %>
                <% else %>
                  <img src="" class="hidden rounded border border-bp-muted/40 max-h-64 object-contain" data-image-preview-target="preview">
                  <span class="text-sm text-gray-400" data-image-preview-target="placeholder">No image selected</span>
                <% end %>
              </div>
              <div class="flex items-center mt-1">
                <%= f.file_field :demo_picture, 
                      direct_upload: true, 
                      accept: "image/*",
                      class: "hidden",
                      data: { 
                        image_preview_target: "input",
                        action: "change->image-preview#preview"
                      } %>
                <button type="button" 
                        class="btn btn-outline" 
                        data-image-preview-target="button"
                        data-action="click->image-preview#trigger">
                  <%= @project.demo_picture.attached? ? "Replace image" : "Choose file" %>
                </button>
                <span class="ml-3" 
                      data-image-preview-target="filename" 
                      data-placeholder="No file selected">No file selected</span>
              </div>
            </div>
          </div>

          <div data-controller="slack-link-validator">
            <%= f.label :build_slack_message, "Slack post link*", class: "block text-xl font-medium font-rc-full" %>
            <p>Post your project in <a href="https://hackclub.slack.com/archives/C09SJ2R1002" target="_blank" class="underline text-bp-warning">#blueprint-drafts</a> and copy the message link! You should include the name of your project, the description, a picture of it, and its github URL! See the existing posts for examples, and ask in #blueprint if you need help</p>
            <%= f.text_field :build_slack_message,
                  required: true,
                  placeholder: "https://hackclub.slack.com/archives/C09SJ2R1002/p...",
                  class: "input px-3 mt-1 block w-full",
                  data: { slack_link_validator_target: "input", action: "input->slack-link-validator#validate paste->slack-link-validator#validate" } %>
            <p class="hidden text-sm text-bp-danger mt-1" data-slack-link-validator-target="error">Please enter a valid Slack message link from #blueprint-drafts! It should look something like this: https://hackclub.slack.com/archives/C09SJ2R1002/p1234567891011121</p>
          </div>

          <div>
            <%= f.label :reviewer_note, "Note to reviewer (optional)", class: "block text-xl font-medium font-rc-full" %>
            <p>Anything you'd like the reviewer to know about your project?</p>
            <%= f.text_area :reviewer_note,
                  rows: 3,
                  class: "input px-3 mt-1 block w-full",
                  placeholder: "e.g. I had to substitute a component because..." %>
          </div>

          <div class="mt-6">
            <%= f.submit "Submit it!", class: "btn btn-primary block w-full" %>
          </div>
  <% end %>
