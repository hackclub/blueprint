<h1 class="text-4xl">Submit project</h1>
<p class="text-xl">Finished designing? Awesome! Fill out this info to submit your project - it'll send it to our queue!</p>

<%= turbo_frame_tag "form_errors" do %>
  <% if @project.errors.any? %>
    <div class="p-4 mb-6 text-red-900 rounded-md bg-bp-danger">
      <p><strong><%= pluralize(@project.errors.count, "error") %></strong> prevented this project from being saved:</p>
      <ul class="pl-5 list-disc">
        <% @project.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>

<%= form_with model: @project, html: { class: "space-y-6", data: { controller: "project-validator", project_validator_project_id_value: @project.id } } do |f| %>
  <%= f.hidden_field :ship, value: true %>

    <div>
      <%= f.label :title, "Title*", class: "block text-xl font-medium font-rc-full" %>
      <%= f.text_field :title,
            required: true,
            class: "input px-3 w-full" %>
    </div>

    <div>
      <%= f.label :description, "Description*", class: "block text-xl font-medium font-rc-full" %>
      <%= f.text_area :description,
            required: true,
            rows: 6,
            class: "input px-3 mt-1 block w-full" %>
    </div>

    <div>
      <%= f.label :repo_link, "Repository link*", class: "block text-xl font-medium font-rc-full" %>
      <%= f.text_field :repo_link,
            required: true,
            placeholder: "https://github.com/...",
            class: "input px-3 mt-1 block w-full" %>
    </div>

    <div>
      <%= f.label :demo_picture, "Project image*", class: "block text-xl font-medium font-rc-full" %>
      <p>This will be your project's banner! It should show your entire finished design</p>
      <div data-controller="image-preview">
        <div class="my-4">
          <% if @project.demo_picture.attached? %>
            <% if @project.demo_picture.content_type == "image/svg+xml" %>
              <%= image_tag @project.demo_picture, class: "rounded border border-bp-muted/40 max-h-64 object-contain", data: { image_preview_target: "preview" } %>
            <% else %>
              <%= image_tag @project.demo_picture.variant(:web), class: "rounded border border-bp-muted/40 max-h-64 object-contain", data: { image_preview_target: "preview" } %>
            <% end %>
          <% else %>
            <img src="" class="hidden rounded border border-bp-muted/40 max-h-64 object-contain" data-image-preview-target="preview">
            <span class="text-sm text-gray-400" data-image-preview-target="placeholder">No image selected</span>
          <% end %>
        </div>
        <div class="flex items-center mt-1">
          <%= f.file_field :demo_picture, 
                direct_upload: true, 
                accept: "image/*",
                class: "hidden",
                data: { 
                  image_preview_target: "input",
                  action: "change->image-preview#preview"
                } %>
          <button type="button" 
                  class="btn btn-outline" 
                  data-image-preview-target="button"
                  data-action="click->image-preview#trigger">
            <%= @project.demo_picture.attached? ? "Replace image" : "Choose file" %>
          </button>
          <span class="ml-3" 
                data-image-preview-target="filename" 
                data-placeholder="No file selected">No file selected</span>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-3" data-controller="checkbox-visual">
      <%= f.check_box :print_legion, class: "sr-only", data: { checkbox_visual_target: "checkbox", action: "change->checkbox-visual#toggle" } %>
      <%= f.label :print_legion, class: "flex items-center gap-3 cursor-pointer" do %>
        <div class="checkbox check-darker" data-checkbox-visual-target="visual"></div>
        <span class="text-lg"><%= @project.ysws == "hackpad" ? "I don't have access to a 3D printer" : "This project needs a 3D print and I don't have access to a 3D printer." %></span>
      <% end %>
    </div>

    <div class="flex items-center gap-3" data-controller="checkbox-visual">
      <%= f.check_box :needs_soldering_iron, class: "sr-only", data: { checkbox_visual_target: "checkbox", action: "change->checkbox-visual#toggle" } %>
      <%= f.label :needs_soldering_iron, class: "flex items-center gap-3 cursor-pointer" do %>
        <div class="checkbox check-darker" data-checkbox-visual-target="visual"></div>
        <span class="text-lg">I don't have access to a soldering iron and need one</span>
      <% end %>
    </div>

    <% if @project.ysws == "hackpad" %>
      <div>
        <%= f.label :approx_hour, "Approximately how many hours did you spend on this project?*", class: "block text-xl font-medium font-rc-full" %>
        <p>This won't affect your review in any way, so please be honest!</p>
        <%= f.number_field :approx_hour, step: 0.1, min: 0, required: true, inputmode: "decimal", class: "input px-3 w-full", placeholder: "e.g. 12.5", oninput: "this.value = this.value.replace(/^(\\d*(?:\\.\\d?)?).*$/, '$1')" %>
      </div>
    <% end %>

    <div>
      <%= f.label :reviewer_note, "Note to reviewer (optional)", class: "block text-xl font-medium font-rc-full" %>
      <p>Anything you'd like the reviewer to know about your project?</p>
      <%= f.text_area :reviewer_note,
            rows: 3,
            class: "input px-3 mt-1 block w-full",
            placeholder: "if not, tell us a joke!" %>
    </div>

    <div class="mt-6">
      <%= f.submit "Submit!", class: "btn btn-primary block w-full" %>
    </div>
  <% end %>
