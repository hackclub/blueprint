<section class="flex flex-col items-center grow">
  <% from_ship = params[:from_ship]%>
  <%= render "shared/button", text: "Back", url: from_ship ? ship_project_path(@project) : project_path(@project), class: "mr-auto py-0.5 px-4 text-base"%>
  <div class="w-full max-w-3xl space-y-4 min-h-full flex flex-col m-8">
    <%= render "shared/card" do %>
      <h1 class="text-4xl">Submit project</h1>
      <p class="text-xl">Review these details and make sure it's correct.</p>

      <%= form_with model: @project, html: { class: "space-y-6", data: { controller: "project-validator", project_validator_project_id_value: @project.id } } do |f| %>
        <%= f.hidden_field :ship, value: true %>

        <% if @project.errors.any? %>
          <div class="p-4 text-red-900 rounded-md bg-bp-danger">
            <p><strong><%= pluralize(@project.errors.count, "error") %></strong> prevented this project from being saved:</p>
            <ul class="pl-5 list-disc">
              <% @project.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div>
          <%= f.label :title, class: "block text-xl font-medium font-rc-full" %>
          <%= f.text_field :title,
                required: true,
                class: "input px-3 w-full" %>
        </div>

        <div>
          <%= f.label :description, class: "block text-xl font-medium font-rc-full" %>
          <%= f.text_area :description,
                required: true,
                rows: 6,
                class: "input px-3 mt-1 block w-full" %>
        </div>

        <div>
          <%= f.label :repo_link, class: "block text-xl font-medium font-rc-full" %>
          <%= f.text_field :repo_link,
                required: true,
                placeholder: "https://github.com/...",
                class: "input px-3 mt-1 block w-full" %>
        </div>

        <% if @project.ysws != "hackpad" %>
          <div data-controller="cart-screenshots" data-paginate-target="page" data-cart-screenshots-needs-funding-value="<%= @project.needs_funding %>" data-cart-screenshots-has-existing-value="<%= @project.cart_screenshots.attached? %>">
            <div class="pt-2 space-y-2">
              <div>
                <%= f.label :cart_screenshots, "Cart screenshots", class: "block text-xl font-rc-full" %>
                <p>Upload screenshots of checkout pages showing the items you will buy and their prices.<p>
              </div>
              <%= f.file_field :cart_screenshots, multiple: true, direct_upload: true, accept: "image/*", class: "input w-full space-x-2", data: { action: "change->cart-screenshots#filesChanged", cart_screenshots_target: "input" } %>
              <p class="hidden text-sm text-bp-danger" data-cart-screenshots-target="error">
                <% if @project.errors[:cart_screenshots].present? %><%= @project.errors[:cart_screenshots].first %><% end %>
              </p>
              <div class="grid grid-cols-2 gap-3 md:grid-cols-3" data-cart-screenshots-target="previews"></div>
            </div>
          </div>
        <% end %>

        <div class="flex items-center gap-3" data-controller="checkbox-visual">
          <%= f.check_box :print_legion, class: "sr-only", data: { checkbox_visual_target: "checkbox", action: "change->checkbox-visual#toggle" } %>
          <%= f.label :print_legion, class: "flex items-center gap-3 cursor-pointer" do %>
            <div class="checkbox check-darker" data-checkbox-visual-target="visual"></div>
            <span class="text-lg"><%= @project.ysws == "hackpad" ? "I don't have access to a 3D printer" : "This project needs a 3D print and I don't have access to a 3D printer." %></span>
          <% end %>
        </div>

        <div class="flex items-center gap-3" data-controller="checkbox-visual">
          <%= f.check_box :needs_soldering_iron, class: "sr-only", data: { checkbox_visual_target: "checkbox", action: "change->checkbox-visual#toggle" } %>
          <%= f.label :needs_soldering_iron, class: "flex items-center gap-3 cursor-pointer" do %>
            <div class="checkbox check-darker" data-checkbox-visual-target="visual"></div>
            <span class="text-lg">I don't have access to a soldering iron and need one</span>
          <% end %>
        </div>

        <div data-controller="funding-amount"
          data-funding-amount-tier-max-cents-value="<%= { 1 => 40000, 2 => 20000, 3 => 10000, 4 => 5000, 5 => 2500 }.to_json %>">
          <% if @project.ysws != "hackpad" %>
            <div class="space-y-6">
              <div>
                <div>
                  <%= f.label :tier, "What tier should this project be?", class: "block text-xl font-medium font-rc-full" %>
                  <p class="text-lg">We may adjust this as we see fit.<br>If you're unsure what to pick, check the <a href="/docs" target="_blank" class="underline text-bp-warning">tier docs</a>.</p>
                </div>
                <div class="w-full text-left text-white select bg-bp-dark">
                  <%= f.select :tier, Project.tier_options, { include_blank: false, selected: @project.tier || 5 }, { class: "text-white bg-bp-dark", style: "color: white; background-color: var(--color-bp-dark);", data: { funding_amount_target: "tierSelect", action: "change->funding-amount#tierChanged" } } %>
                </div>
              </div>
              <div>
                <%= f.label :funding_needed, "How much funding do you need?", class: "block text-xl font-medium font-rc-full" %>
                <p>You do not need to spend up to your tier maximum.</p>
                <div class="relative">
                  <span class="absolute text-lg -translate-y-1/2 left-3 top-1/2">$</span>
                  <input type="text"
                    placeholder="0.00"
                    data-funding-amount-target="input"
                    data-action="input->funding-amount#formatInput"
                    class="w-full pl-8 input"
                    value="<%= @project.funding_needed_cents > 0 ? '%.2f' % (@project.funding_needed_cents / 100.0) : '' %>">
                  <%= f.hidden_field :funding_needed_cents, data: { funding_amount_target: "hidden" }, value: @project.funding_needed_cents %>
                </div>
                <p class="hidden text-sm text-bp-danger" data-funding-amount-target="error"></p>
              </div>
            </div>
          <% end %>

          <div class="mt-6">
            <%= f.submit "Submit it!", class: "btn btn-primary block w-full", data: { funding_amount_target: "submit" } %>
          </div>
        </div>
      <% end %>

    <% end %>
  </div>
</section>